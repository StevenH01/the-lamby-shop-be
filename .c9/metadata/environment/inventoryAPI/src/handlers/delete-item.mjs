{"filter":false,"title":"delete-item.mjs","tooltip":"/inventoryAPI/src/handlers/delete-item.mjs","undoManager":{"mark":16,"position":16,"stack":[[{"start":{"row":0,"column":0},"end":{"row":91,"column":1},"action":"insert","lines":["// Create clients and set shared const values outside of the handler.","","// Create a DocumentClient that represents the query to add an item","import { DynamoDBClient } from '@aws-sdk/client-dynamodb';","import { DynamoDBDocumentClient, DeleteCommand, UpdateCommand, ScanCommand } from '@aws-sdk/lib-dynamodb';","const client = new DynamoDBClient({});","const ddbDocClient = DynamoDBDocumentClient.from(client);","","// Get the DynamoDB table name from environment variables","const tableName = 'citizenTable';","const tableCount = 'citizenTable-Count';","","/**"," * A simple example includes a HTTP get method to get one item by id from a DynamoDB table."," */","export const deleteByIdHandler = async (event) => {","  // if (event.httpMethod !== 'DELETE') {","  //   throw new Error(`deleteMethod only accept DELETE method, you tried: ${event.httpMethod}`);","  // }","  // All log statements are written to CloudWatch","  console.info('received:', event);"," ","  // Retrieve documentNumber from path parameters","  const isRunningLocally = process.env.AWS_SAM_LOCAL;","  var documentNumber;","  if (isRunningLocally == 'false') {","    documentNumber = JSON.parse(event.pathParameters.documentNumber);","  }","  else {","    documentNumber = event.pathParameters.documentNumber;","  }","  // Echo the the value of \"requestId\" from the request header into \"responseId\"","  // var responseId = event.headerParameters.requestId;",""," ","  // Get the item from the table","  // https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html#get-property","  var params = {","    TableName : tableName,","    Key: { documentNumber: documentNumber },","  };","","  // Decrement the itemCount from citizenTable-Count","  try {","      const request = {","        TableName : tableCount,","        ConsistentRead : true","      };","","      const requestedData = await ddbDocClient.send(new ScanCommand(request));","      var count = (requestedData.Items[0].itemCount);","      var newCount = count - 1;","      console.log(\"New count:\", newCount);","","      const command = new UpdateCommand({","        TableName : tableCount,","        Key : {","          documentNumber : \"documentNumber\"","        },","        UpdateExpression : \"set itemCount = :newCount\",","        ExpressionAttributeValues : {","          \":newCount\" : newCount,","        },","        ReturnValues : \"ALL_NEW\"","      });","        await ddbDocClient.send(command);","      ","  } catch (err) {","    console.log(\"Error\", err);","  }","","  // Delete the citizen ","  try {","    const data = await ddbDocClient.send(new DeleteCommand(params));","    var item = data.Item;","    console.log(\"Deleting citizen...\");","    console.log(\"Successfully deleted citizen.\");","  } catch (err) {","    console.log(\"Error\", err);","  }"," ","  const response = {","    statusCode: 200,","    // responseId: responseId,","};"," ","  // All log statements are written to CloudWatch","  console.info(`statusCode: ${response.statusCode}`);","  // console.log(`responseId: ` + responseId);","  console.log(`documentNumber: ` + documentNumber);","  return response;","}"],"id":1}],[{"start":{"row":9,"column":0},"end":{"row":10,"column":40},"action":"remove","lines":["const tableName = 'citizenTable';","const tableCount = 'citizenTable-Count';"],"id":2},{"start":{"row":9,"column":0},"end":{"row":9,"column":44},"action":"insert","lines":["const tableName = process.env.CITIZEN_TABLE;"]}],[{"start":{"row":25,"column":4},"end":{"row":25,"column":18},"action":"remove","lines":["documentNumber"],"id":3},{"start":{"row":25,"column":4},"end":{"row":25,"column":5},"action":"insert","lines":["i"]},{"start":{"row":25,"column":5},"end":{"row":25,"column":6},"action":"insert","lines":["t"]},{"start":{"row":25,"column":6},"end":{"row":25,"column":7},"action":"insert","lines":["e"]},{"start":{"row":25,"column":7},"end":{"row":25,"column":8},"action":"insert","lines":["m"]},{"start":{"row":25,"column":8},"end":{"row":25,"column":9},"action":"insert","lines":["N"]},{"start":{"row":25,"column":9},"end":{"row":25,"column":10},"action":"insert","lines":["a"]},{"start":{"row":25,"column":10},"end":{"row":25,"column":11},"action":"insert","lines":["m"]},{"start":{"row":25,"column":11},"end":{"row":25,"column":12},"action":"insert","lines":["e"]}],[{"start":{"row":25,"column":47},"end":{"row":25,"column":61},"action":"remove","lines":["documentNumber"],"id":4},{"start":{"row":25,"column":47},"end":{"row":25,"column":48},"action":"insert","lines":["i"]},{"start":{"row":25,"column":48},"end":{"row":25,"column":49},"action":"insert","lines":["t"]},{"start":{"row":25,"column":49},"end":{"row":25,"column":50},"action":"insert","lines":["e"]},{"start":{"row":25,"column":50},"end":{"row":25,"column":51},"action":"insert","lines":["m"]},{"start":{"row":25,"column":51},"end":{"row":25,"column":52},"action":"insert","lines":["N"]},{"start":{"row":25,"column":52},"end":{"row":25,"column":53},"action":"insert","lines":["a"]},{"start":{"row":25,"column":53},"end":{"row":25,"column":54},"action":"insert","lines":["m"]},{"start":{"row":25,"column":54},"end":{"row":25,"column":55},"action":"insert","lines":["e"]}],[{"start":{"row":28,"column":4},"end":{"row":28,"column":18},"action":"remove","lines":["documentNumber"],"id":5},{"start":{"row":28,"column":4},"end":{"row":28,"column":5},"action":"insert","lines":["i"]},{"start":{"row":28,"column":5},"end":{"row":28,"column":6},"action":"insert","lines":["t"]},{"start":{"row":28,"column":6},"end":{"row":28,"column":7},"action":"insert","lines":["e"]},{"start":{"row":28,"column":7},"end":{"row":28,"column":8},"action":"insert","lines":["m"]},{"start":{"row":28,"column":8},"end":{"row":28,"column":9},"action":"insert","lines":["N"]},{"start":{"row":28,"column":9},"end":{"row":28,"column":10},"action":"insert","lines":["a"]},{"start":{"row":28,"column":10},"end":{"row":28,"column":11},"action":"insert","lines":["m"]},{"start":{"row":28,"column":11},"end":{"row":28,"column":12},"action":"insert","lines":["e"]}],[{"start":{"row":28,"column":36},"end":{"row":28,"column":50},"action":"remove","lines":["documentNumber"],"id":6},{"start":{"row":28,"column":36},"end":{"row":28,"column":37},"action":"insert","lines":["i"]},{"start":{"row":28,"column":37},"end":{"row":28,"column":38},"action":"insert","lines":["t"]},{"start":{"row":28,"column":38},"end":{"row":28,"column":39},"action":"insert","lines":["e"]},{"start":{"row":28,"column":39},"end":{"row":28,"column":40},"action":"insert","lines":["m"]},{"start":{"row":28,"column":40},"end":{"row":28,"column":41},"action":"insert","lines":["N"]},{"start":{"row":28,"column":41},"end":{"row":28,"column":42},"action":"insert","lines":["a"]},{"start":{"row":28,"column":42},"end":{"row":28,"column":43},"action":"insert","lines":["m"]},{"start":{"row":28,"column":43},"end":{"row":28,"column":44},"action":"insert","lines":["e"]}],[{"start":{"row":23,"column":6},"end":{"row":23,"column":20},"action":"remove","lines":["documentNumber"],"id":7},{"start":{"row":23,"column":6},"end":{"row":23,"column":7},"action":"insert","lines":["i"]},{"start":{"row":23,"column":7},"end":{"row":23,"column":8},"action":"insert","lines":["t"]},{"start":{"row":23,"column":8},"end":{"row":23,"column":9},"action":"insert","lines":["e"]},{"start":{"row":23,"column":9},"end":{"row":23,"column":10},"action":"insert","lines":["m"]},{"start":{"row":23,"column":10},"end":{"row":23,"column":11},"action":"insert","lines":["N"]},{"start":{"row":23,"column":11},"end":{"row":23,"column":12},"action":"insert","lines":["a"]},{"start":{"row":23,"column":12},"end":{"row":23,"column":13},"action":"insert","lines":["m"]},{"start":{"row":23,"column":13},"end":{"row":23,"column":14},"action":"insert","lines":["e"]}],[{"start":{"row":38,"column":11},"end":{"row":38,"column":25},"action":"remove","lines":["documentNumber"],"id":8},{"start":{"row":38,"column":11},"end":{"row":38,"column":12},"action":"insert","lines":["i"]},{"start":{"row":38,"column":12},"end":{"row":38,"column":13},"action":"insert","lines":["t"]},{"start":{"row":38,"column":13},"end":{"row":38,"column":14},"action":"insert","lines":["e"]},{"start":{"row":38,"column":14},"end":{"row":38,"column":15},"action":"insert","lines":["m"]},{"start":{"row":38,"column":15},"end":{"row":38,"column":16},"action":"insert","lines":["N"]},{"start":{"row":38,"column":16},"end":{"row":38,"column":17},"action":"insert","lines":["a"]},{"start":{"row":38,"column":17},"end":{"row":38,"column":18},"action":"insert","lines":["m"]},{"start":{"row":38,"column":18},"end":{"row":38,"column":19},"action":"insert","lines":["e"]}],[{"start":{"row":38,"column":21},"end":{"row":38,"column":35},"action":"remove","lines":["documentNumber"],"id":9},{"start":{"row":38,"column":21},"end":{"row":38,"column":22},"action":"insert","lines":["i"]},{"start":{"row":38,"column":22},"end":{"row":38,"column":23},"action":"insert","lines":["t"]},{"start":{"row":38,"column":23},"end":{"row":38,"column":24},"action":"insert","lines":["e"]},{"start":{"row":38,"column":24},"end":{"row":38,"column":25},"action":"insert","lines":["m"]},{"start":{"row":38,"column":25},"end":{"row":38,"column":26},"action":"insert","lines":["N"]},{"start":{"row":38,"column":26},"end":{"row":38,"column":27},"action":"insert","lines":["a"]},{"start":{"row":38,"column":27},"end":{"row":38,"column":28},"action":"insert","lines":["m"]},{"start":{"row":38,"column":28},"end":{"row":38,"column":29},"action":"insert","lines":["e"]}],[{"start":{"row":40,"column":0},"end":{"row":68,"column":3},"action":"remove","lines":["","  // Decrement the itemCount from citizenTable-Count","  try {","      const request = {","        TableName : tableCount,","        ConsistentRead : true","      };","","      const requestedData = await ddbDocClient.send(new ScanCommand(request));","      var count = (requestedData.Items[0].itemCount);","      var newCount = count - 1;","      console.log(\"New count:\", newCount);","","      const command = new UpdateCommand({","        TableName : tableCount,","        Key : {","          documentNumber : \"documentNumber\"","        },","        UpdateExpression : \"set itemCount = :newCount\",","        ExpressionAttributeValues : {","          \":newCount\" : newCount,","        },","        ReturnValues : \"ALL_NEW\"","      });","        await ddbDocClient.send(command);","      ","  } catch (err) {","    console.log(\"Error\", err);","  }"],"id":10},{"start":{"row":39,"column":4},"end":{"row":40,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":59,"column":15},"end":{"row":59,"column":29},"action":"remove","lines":["documentNumber"],"id":11},{"start":{"row":59,"column":15},"end":{"row":59,"column":16},"action":"insert","lines":["i"]},{"start":{"row":59,"column":16},"end":{"row":59,"column":17},"action":"insert","lines":["t"]},{"start":{"row":59,"column":17},"end":{"row":59,"column":18},"action":"insert","lines":["e"]},{"start":{"row":59,"column":18},"end":{"row":59,"column":19},"action":"insert","lines":["m"]},{"start":{"row":59,"column":19},"end":{"row":59,"column":20},"action":"insert","lines":["N"]},{"start":{"row":59,"column":20},"end":{"row":59,"column":21},"action":"insert","lines":["a"]},{"start":{"row":59,"column":21},"end":{"row":59,"column":22},"action":"insert","lines":["m"]},{"start":{"row":59,"column":22},"end":{"row":59,"column":23},"action":"insert","lines":["e"]}],[{"start":{"row":59,"column":29},"end":{"row":59,"column":43},"action":"remove","lines":["documentNumber"],"id":12},{"start":{"row":59,"column":29},"end":{"row":59,"column":30},"action":"insert","lines":["i"]},{"start":{"row":59,"column":30},"end":{"row":59,"column":31},"action":"insert","lines":["t"]},{"start":{"row":59,"column":31},"end":{"row":59,"column":32},"action":"insert","lines":["e"]},{"start":{"row":59,"column":32},"end":{"row":59,"column":33},"action":"insert","lines":["m"]},{"start":{"row":59,"column":33},"end":{"row":59,"column":34},"action":"insert","lines":["N"]},{"start":{"row":59,"column":34},"end":{"row":59,"column":35},"action":"insert","lines":["a"]},{"start":{"row":59,"column":35},"end":{"row":59,"column":36},"action":"insert","lines":["m"]},{"start":{"row":59,"column":36},"end":{"row":59,"column":37},"action":"insert","lines":["e"]}],[{"start":{"row":14,"column":19},"end":{"row":14,"column":23},"action":"remove","lines":["ById"],"id":13},{"start":{"row":14,"column":19},"end":{"row":14,"column":20},"action":"insert","lines":["I"]},{"start":{"row":14,"column":20},"end":{"row":14,"column":21},"action":"insert","lines":["t"]},{"start":{"row":14,"column":21},"end":{"row":14,"column":22},"action":"insert","lines":["e"]},{"start":{"row":14,"column":22},"end":{"row":14,"column":23},"action":"insert","lines":["m"]}],[{"start":{"row":9,"column":0},"end":{"row":9,"column":44},"action":"remove","lines":["const tableName = process.env.CITIZEN_TABLE;"],"id":14},{"start":{"row":9,"column":0},"end":{"row":9,"column":33},"action":"insert","lines":["const tableName = 'productTable';"]}],[{"start":{"row":41,"column":16},"end":{"row":41,"column":23},"action":"remove","lines":["citizen"],"id":15},{"start":{"row":41,"column":16},"end":{"row":41,"column":17},"action":"insert","lines":["i"]},{"start":{"row":41,"column":17},"end":{"row":41,"column":18},"action":"insert","lines":["t"]},{"start":{"row":41,"column":18},"end":{"row":41,"column":19},"action":"insert","lines":["e"]},{"start":{"row":41,"column":19},"end":{"row":41,"column":20},"action":"insert","lines":["m"]}],[{"start":{"row":45,"column":26},"end":{"row":45,"column":33},"action":"remove","lines":["citizen"],"id":16},{"start":{"row":45,"column":26},"end":{"row":45,"column":27},"action":"insert","lines":["i"]},{"start":{"row":45,"column":27},"end":{"row":45,"column":28},"action":"insert","lines":["t"]},{"start":{"row":45,"column":28},"end":{"row":45,"column":29},"action":"insert","lines":["e"]},{"start":{"row":45,"column":29},"end":{"row":45,"column":30},"action":"insert","lines":["m"]}],[{"start":{"row":46,"column":38},"end":{"row":46,"column":45},"action":"remove","lines":["citizen"],"id":17},{"start":{"row":46,"column":38},"end":{"row":46,"column":39},"action":"insert","lines":["i"]},{"start":{"row":46,"column":39},"end":{"row":46,"column":40},"action":"insert","lines":["t"]},{"start":{"row":46,"column":40},"end":{"row":46,"column":41},"action":"insert","lines":["e"]},{"start":{"row":46,"column":41},"end":{"row":46,"column":42},"action":"insert","lines":["m"]}]]},"ace":{"folds":[],"scrolltop":544.5,"scrollleft":0,"selection":{"start":{"row":46,"column":42},"end":{"row":46,"column":42},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":7,"state":"start","mode":"ace/mode/javascript"}},"hash":"c8468d748bb1b327cf47af6b8f3b88af48bce646","timestamp":1726340467170}